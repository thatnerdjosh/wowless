load("bazel/lua.bzl", "lua_binary", "lua_cc_library", "lua_materialized_cc_library")

cc_binary(
    name = "wowless",
    srcs = ["main.c"],
    deps = [
        ":lib",
        "@elune",
    ],
    features = ["fully_static_link"],
)

lua_materialized_cc_library(
    name = "lib",
    lua = "@elune",
    deps = [
        ":ext",
        "@lsqlite3",
        "@luaexpat",
        "@luafilesystem",
        "@lyaml",
        "@lzlib",
    ],
)

lua_cc_library(
    name = "ext",
    module = "wowless.ext",
    srcs = ["wowless/ext.c"],
)

lua_binary(
    name = "runtests",
    interpreter = ":wowless",
    src = "tools/runtests.lua",
    deps = [
        "@luassert",
    ],
)

lua_binary(
    name = "listfile",
    interpreter = "@puclua",
    src = "tools/listfile.lua",
    deps = ["@penlight"],
)
